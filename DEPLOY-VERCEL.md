# Установка сайта IPTV Best на Vercel

Пошаговая инструкция по деплою Next.js-проекта на [Vercel](https://vercel.com).

---

## 1. Подготовка: репозиторий в Git

Сайт должен находиться в Git-репозитории (GitHub, GitLab или Bitbucket).

### Если репозитория ещё нет

1. Инициализируйте Git в папке проекта (если ещё не сделано):
   ```bash
   git init
   ```

2. Создайте файл `.gitignore`, если его нет. Для Next.js обычно хватает стандартного:
   ```
   .next
   node_modules
   .env*.local
   .vercel
   ```

3. Сделайте первый коммит:
   ```bash
   git add .
   git commit -m "Initial commit"
   ```

4. Создайте репозиторий на [GitHub](https://github.com/new) (или GitLab / Bitbucket), не добавляйте README, .gitignore и лицензию — они уже есть локально.

5. Подключите удалённый репозиторий и отправьте код (подставьте свой URL):
   ```bash
   git remote add origin https://github.com/ВАШ_ЛОГИН/iptvbest.git
   git branch -M main
   git push -u origin main
   ```

---

## 2. Регистрация и импорт проекта в Vercel

1. Откройте [vercel.com](https://vercel.com) и войдите через **GitHub** (или GitLab / Bitbucket). Так Vercel получит доступ к репозиториям.

2. Нажмите **«Add New…»** → **«Project»**.

3. Выберите репозиторий с проектом (например, `iptvbest` или `iptv-best-ru`). Если его нет в списке — нажмите **«Adjust GitHub App Permissions»** и дайте доступ нужной организации/репозиторию.

4. Vercel сам определит **Framework Preset: Next.js**. Оставьте как есть.

5. Поля для сборки обычно заполняются автоматически:
   - **Root Directory** — оставьте пустым (проект в корне репо).
   - **Build Command** — `next build` (по умолчанию).
   - **Output Directory** — не меняйте (для Next.js не используется).
   - **Install Command** — `npm install` (по умолчанию).

6. Перед деплоем добавьте переменные окружения (см. шаг 3 ниже), затем нажмите **«Deploy»**.

---

## 3. Переменные окружения (Environment Variables)

В настройках проекта (при импорте или после: **Project → Settings → Environment Variables**) добавьте переменные, которые использует сайт.

### Обязательные для верификации (если подтверждаете сайт в поисковиках)

| Имя | Значение | Где взять |
|-----|----------|-----------|
| `NEXT_PUBLIC_GOOGLE_SITE_VERIFICATION` | Код из Google Search Console (способ «HTML-тег») | [search.google.com/search-console](https://search.google.com/search-console) |
| `NEXT_PUBLIC_YANDEX_VERIFICATION` | Код из Яндекс.Вебмастер (способ «Мета-тег») | [webmaster.yandex.ru](https://webmaster.yandex.ru) |

Для каждой переменной укажите **Environment**: Production (и при необходимости Preview, если нужны коды и на превью).

Остальные переменные у проекта могут не использоваться — смотрите свой код и `VERIFICATION.md`.

---

## 4. Деплой и проверка

1. После нажатия **«Deploy»** Vercel соберёт проект и выдаст ссылку вида:
   `https://iptv-best-ru-xxxx.vercel.app`
   (или другое имя по названию репо).

2. Откройте эту ссылку и проверьте:
   - открывается главная;
   - работают переходы по разделам, провайдерам, блогу, поиску;
   - переход «Перейти на сайт» ведёт на `/go/[slug]` и далее на сайт провайдера.

3. Дальнейшие пуши в ветку `main` (или в ту ветку, которую вы выбрали при импорте) будут автоматически запускать новый деплой.

---

## 5. Подключение своего домена (iptv-best.ru)

1. В Vercel: откройте проект → вкладка **Settings** → **Domains**.

2. Нажмите **«Add»** и введите домен: `iptv-best.ru`.  
   При желании добавьте и `www.iptv-best.ru` — Vercel предложит настроить редирект с одного на другой (обычно с www на без www или наоборот).

3. Vercel покажет, какие DNS-записи нужно создать у регистратора домена.

### Вариант A: использование поддоменов Vercel (проще)

- Тип записи: **CNAME**  
- Имя (Host): `www` (если подключаете www) или `@` (если ваш регистратор разрешает CNAME для корня).  
- Значение (Target): `cname.vercel-dns.com`.

Для корня домена (`iptv-best.ru` без www) многие регистраторы требуют **A-запись**:
- Тип: **A**  
- Имя: `@`  
- Значение: `76.76.21.21` (IP Vercel — актуальный уточняйте в панели Vercel в разделе Domains).

### Вариант B: DNS через Vercel (если регистратор поддерживает смену NS)

В разделе **Domains** Vercel можно переключить домен на серверы Vercel (показаны адреса типа `ns1.vercel-dns.com`, `ns2.vercel-dns.com`). Тогда все записи настраиваются уже в Vercel.

4. После сохранения записей у регистратора подождите 5–60 минут (иногда до 24 часов). В Vercel во вкладке **Domains** статус домена сменится на «Valid» или «Ready».

5. Vercel автоматически выпустит SSL-сертификат (HTTPS) для вашего домена.

---

## 6. Полезные настройки в Vercel

- **Settings → General → Build & Development Settings**  
  При необходимости можно задать **Node.js Version** (например, 18.x или 20.x), если сборка требует конкретную версию.

- **Settings → Git**  
  Выбор ветки для продакшн-деплоев (по умолчанию `main`). Включение **Preview Deployments** для веток и pull request’ов.

- **Settings → Environment Variables**  
  Все переменные, которые нужны при `next build` или в рантайме (с префиксом `NEXT_PUBLIC_`), должны быть заданы для окружения **Production** (и при необходимости **Preview**).

- **Analytics / Speed Insights**  
  В Vercel можно включить встроенную аналитику и замер скорости — по желанию, отдельно от Яндекс.Метрики.

---

## 7. Частые проблемы

**Сборка падает с ошибкой по памяти**  
В **Settings → General** можно включить опцию **Serverless Function Region** и при необходимости увеличить лимиты (если доступно в вашем плане). Для типичного Next.js-сайта хватает настроек по умолчанию.

**После деплоя 404 на страницах**  
Убедитесь, что в настройках проекта не задан **Output Directory** (для Next.js он не используется). Должна использоваться стандартная сборка `next build`.

**Домен не привязывается**  
Проверьте, что DNS-записи сохранены у регистратора именно для домена `iptv-best.ru` (или www), что прошло достаточно времени для обновления DNS, и что в Vercel в **Domains** указан тот же домен без опечаток.

**Переменные не подставляются**  
Переменные окружения в Vercel подхватываются при сборке. После добавления или изменения переменных сделайте **Redeploy** проекта (Deployments → три точки у последнего деплоя → Redeploy).

---

После выполнения шагов сайт будет доступен по выданному Vercel URL, а после настройки домена — по адресу **https://iptv-best.ru**. Дальнейшие обновления — через `git push` в подключённый репозиторий.
